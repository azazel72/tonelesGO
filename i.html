<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Tabulator v6 - list sin blanco</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Asegúrate de que CSS y JS son de la MISMA versión -->
  <link href="https://unpkg.com/tabulator-tables@6.2.0/dist/css/tabulator.min.css" rel="stylesheet">
  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 20px; }
    #tabla { height: 360px; }
    /* Por si tu CSS global pone el texto blanco: fuerza color legible en la lista */
    .tabulator-edit-list .tabulator-list-item { color: #222; }

.tabulator-edit-list .tabulator-edit-list-item.focused {
  background:#83a8e2 !important;
}

  </style>
</head>
<body>
  <h1>Editor "list" funcionando</h1>
  <div id="tabla"></div>

  <script src="https://unpkg.com/tabulator-tables@6.2.0/dist/js/tabulator.min.js"></script>
  <script>
    const datos = [
      { id: 1, nombre: "Ana",   estado: "OK",  rol: "admin" },
      { id: 2, nombre: "Luis",  estado: "BAD", rol: "user"  },
      { id: 3, nombre: "Marta", estado: "OK",  rol: "guest" },
      { id: 4, nombre: "Paco",  estado: "NEW", rol: "user"  },
    ];

    // 1er list: array {label,value}
    const estadosMap = { OK:"Operativo", BAD:"Con incidencias", NEW:"Nuevo" };
    const estadosList = Object.entries(estadosMap).map(([value, label]) => ({ label, value }));
    const transformados = datos.map(({ estado, ...resto }) => ({
  ...resto,
  value: estado,
  label: estado,
}));

    // 2º list: objeto simple {value: label} (evita blancos por estructura)
    const rolesMap = { admin:"Administrador", user:"Usuario", guest:"Invitado" };

    const tabla = new Tabulator("#tabla", {
      data: datos,
      layout: "fitDataStretch",
      columns: [
        { title: "ID", field: "id", width: 70, hozAlign: "right" },
        {
          title: "Estado",
          field: "estado",
          editor: "list",
          editorParams: {
            values: transformados,      // [{label,value}]
            // autocomplete: true,     // opcional
            valuesLookup:"active", //get the values from the currently active rows in this column
            //Value Lookup Configuration (use these with valuesLookup Option)
            valuesLookupField:"estado",
            clearable:true, 
            itemFormatter:function(label, value, item, element){
              console.log(element);
                return "<strong>" + label + " </strong><br/><div>" + item.nombre+ "</div>";
            },
                    mask:"AAA-999", //apply input mask to text entry
    freetext:true,
          },
          formatter: cell => estadosMap[cell.getValue()] ?? cell.getValue(),
        },
        {
          title: "Rol",
          field: "rol",
          editor: "list",
          editorParams: {
            values: rolesMap,
        autocomplete: true,
        allowEmpty: true,
        listOnEmpty: true,
        freetext: true,

          },
          formatter: cell => rolesMap[cell.getValue()] ?? cell.getValue(),
        },        
           {
      title: "Location",
      field: "locastion",
      width: 130,
      editor: "list",
      editorParams: {
        values: ["USA", "China", "South America"], //an array of values or value/label objects
        autocomplete: true,
        allowEmpty: true,
        listOnEmpty: true,
        freetext: true,
      },
    },

        { title: "Nombre", field: "nombre", editor: "input" },
      ],
    });

    window.tabla = tabla;
  </script>
</body>
</html>
